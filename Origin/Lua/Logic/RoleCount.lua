
ERoleCount = {
  FriendGiftReceive = 6,
  FriendGiftSend = 7,
  Dispatch = 8,              --每日派遣次數
  BuyDispatch = 9,           --每日購買派遣次數
  OnlineTime = 10,           --在線時間
  Messageboard = 13,         --在線時間
  OrgBoss = 42,              --軍團BOSS攻擊次數
  ExpPill = 90,              --經驗丹 90~98
  ExpPill_Green = 91,        --青綠經驗丹 三轉每日限定使用次數
  ExpPill_Yellow = 92,       --釉黃經驗丹 三轉每日限定使用次數
  ExpPill_Pink = 93,         --粉紅經驗丹 三轉每日限定使用次數
  ExpPill_Red = 94,          --熾焰經驗丹 三轉每日限定使用次數
  ExpPill_SkyBlue = 95,      --天藍經驗丹 三轉每日限定使用次數
  ExpPill_WaterBlue = 96,    --水藍經驗丹 三轉每日限定使用次數
  ExpPill_Orange = 97,       --橘橙經驗丹 三轉每日限定使用次數
  ExpPill_Purple = 98,       --藏紫經驗丹 三轉每日限定使用次數
  Bank_1 = 101,              --錢莊開啟格數1
  Inn = 102,
  Bag_1 = 103,               --背包開啟格數1
  Bag_2 = 106,               --背包開啟格數2
  LoginSingDay = 107,        --簽到領獎次數
  ContinueLogin = 108,       --連續登入天數
  ContinueLoginAward = 109,  --連續登入領獎次數
  NpcDebris = 110,           --武將碎片
  EquipDebris = 111,         --裝備碎片
  Save = 116,                --儲值送
  Back_1 = 117,              --第一天消費返利
  Back_2 = 118,              --第二天消費返利
  Back_3 = 119,              --第三天消費返利
  Back_4 = 120,              --第四天消費返利
  Back_5 = 121,              --第五天消費返利
  Back_6 = 122,              --第六天消費返利
  Back_7 = 123,              --第七天消費返利
  Bag_3 = 124,               --背包開啟格數3
  Bank_2 = 125,              --錢莊開啟格數2
  Bank_3 = 126,              --錢莊開啟格數3
  Consume = 128,             --消費送
  LottoNpc = 129,            --抽抽樂武將
  LottoCard = 130,           --抽抽樂卡片
  DoubleSaveVal = 131,       --儲值雙倍送-儲值金額
  DoubleSaveBack = 132,      --儲值雙倍送-總元寶數
  Furnace = 133,             --黃金熔爐
  Scratch_100 = 134,         --儲值刮刮樂-面額100
  Scratch_500 = 135,         --儲值刮刮樂-面額500
  Scratch_1000 = 136,        --儲值刮刮樂-面額1000
  Scratch_Bonus = 137,       --儲值刮刮樂-累積儲值金額
  CScratch_100 = 141,        --消費刮刮樂-面額200
  CScratch_500 = 142,        --消費刮刮樂-面額500
  CScratch_1000 = 143,       --消費刮刮樂-面額1000
  CScratch_Bonus = 144,      --消費刮刮樂-累積儲值金額
  Poke = 146,                --戳戳樂送
  CatchSuccess = 151,
  Die = 152,
  Compound = 154,            --合成累積次數
  Dungeon_Money = 155,       --金幣副本累積次數
  Collection_Npc = 159,      --武將收集冊數量
  Mounts = 160,
  Equip_Element = 161,       --裝備精煉累積次數
  Dungeon_Multiple = 162,    --多人副本累積次數
  Fight = 163,               --戰鬥次數
  Pk = 164,                  --與玩家PK累積次數
  TotalDispatch = 165,       --累計派遣次數
  Collection_Card = 166,     --卡片收集冊
  Npc_Star = 167,            --武將累積星數
  OffLine_Exp = 169,         --累積經驗_領取清掉
  OffLine_Gold = 170,        --累積花費_領取清掉(元寶)
  OffLine_AccTime = 171,     --累積時數(分鐘)_領取清掉
  OffLine_Time = 172,        --每日累計離線時間(分鐘)_每日最多8小時
  DragonBox = 186,           --藏龍寶箱
  ClassAward = 189,          --達標領獎
  SkillPoint = 190,          --角色技能點配置(特殊計數)
  AttribiutPoint = 191,      --角色屬性點配置(特殊計數)
  Friend = 192,              --好友數量(特殊計數)
  None_1 = 193,              --待設定(特殊計數)
  None_2 = 194,              --待設定(特殊計數)
  None_3 = 195,              --待設定(特殊計數)
  SWeaponDebris = 654,       --專武碎片
  ActLogin = 651,            --累積登入領獎
  ActAccLogin = 652,         --連續登入領獎
  MaxActAccLogin = 653,      --最大連續登入領獎
  ReturnLogin = 665,         --最大連續登入領獎
  Swimming = 667,            --泳池獎勵
  ReUseAct_1 = 668,          --重覆使用(one RoleCount)
  ReUseAct_2 = 669,          --重覆使用(one RoleCount)
  DataFightBuy = 669,        --資料對戰購買次數(日清)
  DataFight = 670,           --資料對戰次數(日清)
  GoldenTicket = 671,        --競技慶典用投票券(金券)
  SilverTicket = 672,        --競技慶典用投票券(銀券)
  SilverTicket = 672,        --競技慶典用投票券(銀券)
  Storage_1 = 676,           --寶庫元寶擴充
  Storage_2 = 677,           --寶庫活動擴充
  CityScramble_Buy = 682,    --城鎮爭奪：購買次數
  CityScramble_ChallengeRight = 683, --城鎮爭奪：挑戰權數
  CityScramble_Stake = 684 , --城鎮爭奪：木樁數
  PurchaseFreeCount = 686,   --玩家免單已使用次數
  PurchaseFreeQuota = 687,   --玩家免單已使用額度
  PurchaseFreeAmount = 688,  --玩家商城累計消費額度(免單特權使用)
  MonopolyRound = 693,       --大富翁迴圈
  MonopolyDice = 694,        --大富翁骰子
  SouvenirFeedbackExp = 696, --回饋獎勵經驗值
  EternalDungeon = 707,      --永恆地城
  Sacrifice = 730,           --祭祀次數
  BattlePassExp = 791,       --通行證總積分
  BattleFreeLv = 792,        --通行證免費獎勵領取階段
  BattlePaidLv = 793,        --通行證付費獎勵領取階段
  MarketCanUpload = 794,     --Web市集可上傳次數
  SoulGachaCount = 795,      --靈魂抽累積次數
  BuyGiftMaxMoney = 987,     --每日購買禮物金額上限
  MarketTsGoldLimit = 1030,  --Web市集吞食幣每日可上傳次數
}

--[[
And these two had a dream on the same night; the chief wine-servant and the chief bread-maker of the king of Egypt, who were in prison, the two of them had dreams with a special sense.
And in the morning when Joseph came to them he saw that they were looking sad.
And he said to the servants of Pharaoh who were in prison with him, Why are you looking so sad?
Then they said to him, We have had a dream, and no one is able to give us the sense. And Joseph said, Does not the sense of dreams come from God? what was your dream?
Then the chief wine-servant gave Joseph an account of his dream, and said, In my dream I saw a vine before me;
And on the vine were three branches; and it seemed as if it put out buds and flowers, and from them came grapes ready for cutting.
And Pharaoh's cup was in my hand, and I took the grapes and crushing them into Pharaoh's cup, gave the cup into Pharaoh's hand.
Then Joseph said, This is the sense of your dream: the three branches are three days;
After three days Pharaoh will give you honour, and put you back into your place, and you will give him his cup as you did before, when you were his wine-servant.
But keep me in mind when things go well for you, and be good to me and say a good word for me to Pharaoh and get me out of this prison:
For truly I was taken by force from the land of the Hebrews; and I have done nothing for which I might be put in prison.
Now when the chief bread-maker saw that the first dream had a good sense, he said to Joseph, I had a dream; and in my dream there were three baskets of white bread on my head;
And in the top basket were all sorts of cooked meats for Pharaoh; and the birds were taking them out of the baskets on my head.
Then Joseph said, This is the sense of your dream: the three baskets are three days;
--]]

RoleCount = {};
local this = RoleCount;

this.countDatas = {};

local roleCountNotiy = {};

function RoleCount.Initialize()
  NotifyManager.Register(ENotifyManager.RoleCount, "RoleCount", this.RoleCountUpdate);

  this.Register(ERoleCount.Bag_1, "Bag", Item.RefreshRoleCount);
  this.Register(ERoleCount.Bag_2, "Bag", Item.RefreshRoleCount);
  this.Register(ERoleCount.Bag_3, "Bag", Item.RefreshRoleCount);
  this.Register(ERoleCount.Bank_1, "Bank", Item.RefreshRoleCount);
  this.Register(ERoleCount.Bank_2, "Bank", Item.RefreshRoleCount);
  this.Register(ERoleCount.Bank_3, "Bank", Item.RefreshRoleCount);
  this.Register(ERoleCount.Storage_1, "Bank", Item.RefreshRoleCount);
  this.Register(ERoleCount.Storage_2, "Bank", Item.RefreshRoleCount);
  this.Register(ERoleCount.Inn, "Inn", Inn.RefreshRoleCount);
  this.Register(ERoleCount.FriendGiftReceive, "Social", Social.RefreshRoleCount);
  this.Register(ERoleCount.FriendGiftSend, "Social", Social.RefreshRoleCount);
  this.Register(ERoleCount.LoginSingDay, "LoginAward", UILoginAward.RefreshRoleCount);
  this.Register(ERoleCount.ContinueLogin, "LoginAward", UILoginAward.RefreshRoleCount);
  this.Register(ERoleCount.ContinueLoginAward, "LoginAward", UILoginAward.RefreshRoleCount);
  this.Register(ERoleCount.Save, "LoginAward", UILoginAward.RefreshRoleCount);
  this.Register(ERoleCount.Back_1, "LoginAward", UILoginAward.RefreshRoleCount);
  this.Register(ERoleCount.Back_2, "LoginAward", UILoginAward.RefreshRoleCount);
  this.Register(ERoleCount.Back_3, "LoginAward", UILoginAward.RefreshRoleCount);
  this.Register(ERoleCount.Back_4, "LoginAward", UILoginAward.RefreshRoleCount);
  this.Register(ERoleCount.Back_5, "LoginAward", UILoginAward.RefreshRoleCount);
  this.Register(ERoleCount.Back_6, "LoginAward", UILoginAward.RefreshRoleCount);
  this.Register(ERoleCount.Back_7, "LoginAward", UILoginAward.RefreshRoleCount);
  this.Register(ERoleCount.OffLine_Time, "LoginAward", UILoginAward.RefreshRoleCount);
  this.Register(ERoleCount.OffLine_Exp, "LoginAward", UILoginAward.RefreshRoleCount);
  this.Register(ERoleCount.OffLine_Gold, "LoginAward", UILoginAward.RefreshRoleCount);
  this.Register(ERoleCount.OffLine_AccTime, "LoginAward", UILoginAward.RefreshRoleCount);
  this.Register(ERoleCount.Scratch_100, "LoginAward", UILoginAward.RefreshScratchRoleCount);
  this.Register(ERoleCount.Scratch_500, "LoginAward", UILoginAward.RefreshScratchRoleCount);
  this.Register(ERoleCount.Scratch_1000, "LoginAward", UILoginAward.RefreshScratchRoleCount);
  this.Register(ERoleCount.Scratch_Bonus, "LoginAward", UILoginAward.RefreshScratchRoleCount);
  this.Register(ERoleCount.CScratch_100, "LoginAward", UILoginAward.RefreshScratchRoleCount);
  this.Register(ERoleCount.CScratch_500, "LoginAward", UILoginAward.RefreshScratchRoleCount);
  this.Register(ERoleCount.CScratch_1000, "LoginAward", UILoginAward.RefreshScratchRoleCount);
  this.Register(ERoleCount.CScratch_Bonus, "LoginAward", UILoginAward.RefreshScratchRoleCount);
  this.Register(ERoleCount.OrgBoss, "Army", Organization.OnBossTimesChanged);
  this.Register(ERoleCount.Sacrifice, "Sacrifice", Requiem.UpdateSacrificePoints);
  this.Register(ERoleCount.MarketCanUpload, "Market", Market.UpdateCanTradeCount);
  this.Register(ERoleCount.BattlePassExp, "BattlePass", BattlePass.UpdateExp);
  this.Register(ERoleCount.BattlePaidLv, "BattlePass", BattlePass.UpdateAwardTake);
  this.Register(ERoleCount.BattleFreeLv, "BattlePass", BattlePass.UpdateAwardTake);
  this.Register(ERoleCount.MonopolyRound, "MonopolyRound", UIMonopoly.UpdateRound);
  this.Register(ERoleCount.MonopolyDice, "MonopolyDice", UIMonopoly.UpdateDiceCount);
end

function RoleCount.TestPas(pat)
  if pat > 100 then
    for i = 1 , 100 do
      pat = pat - i;
    end
    return pat;
  else
    return nil;
  end
end

function RoleCount.TestPas1(pat)
  if pat > 100 then
    for i = 1 , 100 do
      pat = pat - i;
    end
    return pat;
  else
    return nil;
  end
end

function RoleCount.Register(kind, id, notifyFunc)
  if roleCountNotiy[kind] ~= nil and roleCountNotiy[kind][id] ~= nil then
    return;
  end
  
  if roleCountNotiy[kind] == nil then
    roleCountNotiy[kind] = {};
  end
  
  roleCountNotiy[kind][id] = notifyFunc;
end

function RoleCount.Clear()
  table.Clear(this.countDatas);
end

function RoleCount.TestPas2(pat)
  if pat > 100 then
    for i = 1 , 100 do
      pat = pat - i;
    end
    return pat;
  else
    return nil;
  end
end

function RoleCount.Set(index, value, max, endSetData)
  this.countDatas[index] = {};
  this.countDatas[index].index = index;
  this.countDatas[index].value = value;
  this.countDatas[index].max = max;

  NotifyManager.Notify(ENotifyManager.RoleCount, this.countDatas[index]);

  if index == ERoleCount.Messageboard then
    if UI.IsVisible(UIMessageboard) then
      UIMessageboard.UpdateUI();
    end
  end
  
  if endSetData then
    NotifyManager.Notify("CheckCondition", { ECondition.RoleCount, index } );
    if index >= 401 and index <= 600 then 
      UICollectBook.CheckCardRedDot();
    end

    if index == 170 then
      Mall.IsRedDot();
    end
  end
end

function RoleCount.Get(index)
  if index >= 190 and index <= 195  then
    return bit.rshift(this.countDatas[index].value, 16);
  elseif this.countDatas[index] ~= nil then
    return this.countDatas[index].value;
  else
    return 0;
  end
end

function RoleCount.RoleCountUpdate(data)
  if roleCountNotiy[data.index] ~= nil then
    for k, func in pairs(roleCountNotiy[data.index]) do
      func(data);
    end
  end
end

function RoleCount.TestPas3(pat)
  if pat > 100 then
    for i = 1 , 100 do
      pat = pat - i;
    end
    return pat;
  else
    return nil;
  end
end

function RoleCount.TestPas4(pat)
  if pat > 100 then
    for i = 1 , 100 do
      pat = pat - i;
    end
    return pat;
  else
    return nil;
  end
end

function RoleCount.TestPas5(pat)
  if pat > 100 then
    for i = 1 , 100 do
      pat = pat - i;
    end
    return pat;
  else
    return nil;
  end
end

function RoleCount.Max(index)
  if this.countDatas[index] ~= nil then
    return this.countDatas[index].max;  
  else
    return 0;
  end
end

function RoleCount.TestPas6(pat)
  if pat > 100 then
    for i = 1 , 100 do
      pat = pat - i;
    end
    return pat;
  else
    return nil;
  end
end
